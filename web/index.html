<!doctype html>
<html lang="de">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/custom.css">

    <script src="./js/jquery-3.4.1.min.js"></script>

    <style>

        body {
            padding-top: 5rem;
        }
        .starter-template {
            padding: 3rem 1.5rem;
            /*text-align: center;*/
        }

    </style>
    <script>

        //var url = "seats.ub.uni-leipzig.de/api";
        var url = "localhost:12105";
        var proto = "http";

        var readernumber = "";
        var token = "";

        var booked_workspace = 0, bookingCode = 0, email = "";
        var from = "", until="";

        function reservation() {
            $("#startdiv").load("login.html");
        }

        function logout() {
            $.ajax({
               url: proto+'://'+url+'/booking/logout',
               type: 'post',
               data: '{ "token": "'+token+'", "readernumber": "'+readernumber+'" }',
                success: function (data) {
                    $("#startdiv").load("login.html");
                }
            });
        }

        function login() {

            $.ajax({
                url: proto+'://'+url+'/booking/login',
                type: 'post',
                data: $('#loginform').serialize(),
                success: function (data) {
                    if(data!="null") {
                            token = data;
                            $("#startdiv").removeClass("starter-template");
                            $("#startdiv").load("booking.html");
                        }
                    else
                        alert("Ihre Logindaten sind leider falsch.");
                }
            });

            readernumber = $("#readernumber").val();

        }

        function do_reservation() {

            var d1 = $("#from_date").val();

            var t1 = $("#from_time").val();
            var v1 = $("#from_time").attr("min");
            var v2 = $("#from_time").attr("max");

            var t2 = $("#until_time").val();
            var w1 = $("#until_time").attr("min");
            var w2 = $("#until_time").attr("max");

            if(t1<v1||t1>v2||t2<w1||t2>w2||t2<t1||d1==""||t1==t2) {
                alert("Zeit-Fehler!");
                return;
            }

            $.ajax({
                url: proto+'://'+url+'/booking/booking',
                type: 'post',
                data: $('#booking').serialize(),
                success: function(data) {

                    var jsondata = $.parseJSON(data);

                    booked_workspace = jsondata.workspaceId;
                    bookingCode = jsondata.bookingCode;
                    email = jsondata.email;

                    if(booked_workspace=="") alert("Leider konnte kein freier Platz zu Ihren Konditionen gefunden werden!");
                    else {
                        $("#startdiv").addClass("starter-template");
                        $("#startdiv").load("result.html");
                    }

                }
            });
        }

        function getAreas() {
           $.ajax({
                url: proto+'://'+url+'/booking/areas?institution='+$("#institution").val(),
                type: 'get',
                success: function(data) {
                    $("#area option").remove();
                        $("#area").append("<option value=\"no selection\">Keine Auswahl</option>");
                        data.split("#").forEach(function(e){
                            $("#area").append("<option value=\""+e+"\">"+e+"</option>");
                        });
                    }
            });

            $.ajax({
                url: proto+'://'+url+'/booking/timeslots?institution='+$("#institution").val(),
                type: 'get',
                success: function(data) {
                    $("#from_time").attr({"min": data.from, "max": data.until, "value": data.from});
                    $("#until_time").attr({"min": data.from, "max": data.until, "value": data.from});
                }
            });

        }

    </script>
    <title>Universitätsbibliothek Leipzig - Arbeitsplatzbuchungssystem</title>
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
    <div class="navbar-inner container">
    <a class="navbar-brand" href="#">Arbeitsplatzbuchungssystem</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    </div>
</nav>

<main role="main" class="container">

    <div class="starter-template" id="startdiv">

        <h1>Universitätsbibliothek Leipzig - Arbeitsplatzbuchung</h1>

        <h2>Was möchten Sie tun?</h2>
        <p>
            <a class="btn btn-primary" href="javascript:reservation()">Einen Arbeitsplatz reservieren</a>
        </p>
        <p>
            <a class="btn btn-primary" href="javascript:manage()">Eine Reservierung ändern/stornieren</a>
        </p>
    </div>

</main>

<script src="./js/popper.min.js"></script>
<script src="./js/bootstrap.min.js"></script>
</body>
</html>